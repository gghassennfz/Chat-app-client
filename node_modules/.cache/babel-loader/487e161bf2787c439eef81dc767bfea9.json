{"ast":null,"code":"import _toConsumableArray from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _objectSpread from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _asyncToGenerator from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import{NEW_USER_DATA,newUserDataState,AUTH_USER,LOGIN_USER_DATA,FORGOT_PASSWORD,RESET_PASSWORD_DATA,CONVERSATIONS,USERS,ACTIVE_CONVERSATION,MESSAGE_DATA,PROFILE_DATA,CHANGE_PASSWORD}from\"./types\";import axios from\"../utils/axios\";import history from\"../utils/history\";import{emailConfirmation,root}from\"../utils/Routes\";import EMOJIS from\"../utils/emojis\";import{saveToken,loadDataHelper}from\"./helper\";export var setNewUserData=function setNewUserData(newUser,username,email,password,confirmPassword,state){if(newUser){return{type:NEW_USER_DATA,payload:{username:username,email:email,password:password,confirmPassword:confirmPassword,state:state}};}else{return{type:NEW_USER_DATA,payload:null};}};export var signupUser=function signupUser(){return/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,getState){var _getState,newUserData;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_getState=getState(),newUserData=_getState.newUserData;newUserData.joinedAt=Date.now();_context.prev=2;_context.next=5;return axios.post(\"/api/v1/users/signup\",newUserData);case 5:dispatch({type:NEW_USER_DATA,payload:_objectSpread(_objectSpread({},newUserData),{},{state:newUserDataState.submitted})});history.push(emailConfirmation);_context.next=12;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](2);dispatch({type:NEW_USER_DATA,payload:_objectSpread(_objectSpread({},newUserData),{},{state:newUserDataState.failed})});case 12:case\"end\":return _context.stop();}}},_callee,null,[[2,9]]);}));return function(_x,_x2){return _ref.apply(this,arguments);};}();};export var resendAccountActivateEmail=function resendAccountActivateEmail(){return/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(dispatch,getState){var _getState2,newUserData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_getState2=getState(),newUserData=_getState2.newUserData;dispatch({type:NEW_USER_DATA,payload:_objectSpread(_objectSpread({},newUserData),{},{state:newUserDataState.resubmitting})});_context2.prev=2;_context2.next=5;return axios.post(\"/api/v1/users/resendActivationLink\",{email:newUserData.email});case 5:dispatch({type:NEW_USER_DATA,payload:_objectSpread(_objectSpread({},newUserData),{},{state:newUserDataState.submitted})});history.push(emailConfirmation);_context2.next=12;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);dispatch({type:NEW_USER_DATA,payload:_objectSpread(_objectSpread({},newUserData),{},{state:newUserDataState.emailNotExist})});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function(_x3,_x4){return _ref2.apply(this,arguments);};}();};export var activateAccount=function activateAccount(token){return/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(dispatch){var user;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:dispatch({type:NEW_USER_DATA,payload:{username:\"\",email:\"\",password:\"\",confirmPassword:\"\",state:newUserDataState.activatingAccount}});_context3.prev=1;_context3.next=4;return axios.get(\"/api/v1/users/activateAccount/\".concat(token));case 4:user=_context3.sent;dispatch({type:AUTH_USER,payload:{token:user.data.token,user:user.data.user}});dispatch({type:NEW_USER_DATA,payload:{username:\"\",email:\"\",password:\"\",confirmPassword:\"\",state:newUserDataState.accountActivated}});saveToken(user.data.token);history.push(\"/conversations\");loadDataHelper(dispatch,user.data.token,true,true,user.data.user);_context3.next=15;break;case 12:_context3.prev=12;_context3.t0=_context3[\"catch\"](1);dispatch({type:NEW_USER_DATA,payload:{username:\"\",email:\"\",password:\"\",confirmPassword:\"\",state:newUserDataState.invalidToken}});case 15:case\"end\":return _context3.stop();}}},_callee3,null,[[1,12]]);}));return function(_x5){return _ref3.apply(this,arguments);};}();};export var setLoginData=function setLoginData(mount,email,password){if(mount){return{type:LOGIN_USER_DATA,payload:{email:email,password:password}};}else{return{type:LOGIN_USER_DATA,payload:null};}};export var loginUser=function loginUser(){return/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(dispatch,getState){var _getState3,loginUserData,user;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_getState3=getState(),loginUserData=_getState3.loginUserData;dispatch({type:LOGIN_USER_DATA,payload:_objectSpread(_objectSpread({},loginUserData),{},{state:\"submitting\"})});_context4.prev=2;_context4.next=5;return axios.post(\"/api/v1/users/login\",loginUserData);case 5:user=_context4.sent;dispatch({type:AUTH_USER,payload:{user:user.data.user}});saveToken(user.data.token);history.push(\"/conversations\");loadDataHelper(dispatch,user.data.token,true,true,user.data.user);_context4.next=15;break;case 12:_context4.prev=12;_context4.t0=_context4[\"catch\"](2);dispatch({type:LOGIN_USER_DATA,payload:_objectSpread(_objectSpread({},loginUserData),{},{loginFailed:true,state:\"failed\"})});case 15:case\"end\":return _context4.stop();}}},_callee4,null,[[2,12]]);}));return function(_x6,_x7){return _ref4.apply(this,arguments);};}();};export var setForgotPassword=function setForgotPassword(email,state,mount){if(mount){return{type:FORGOT_PASSWORD,payload:{email:email,state:state}};}else{return{type:FORGOT_PASSWORD,payload:null};}};export var sendForgotPassword=function sendForgotPassword(){return/*#__PURE__*/function(){var _ref5=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(dispatch,getState){var email;return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:email=getState().forgotPassword.email;dispatch({type:FORGOT_PASSWORD,payload:{email:email,state:\"submitting\"}});_context5.prev=2;_context5.next=5;return axios.post(\"/api/v1/users/forgotPassword\",{email:email});case 5:dispatch({type:FORGOT_PASSWORD,payload:{email:email,state:\"submitted\"}});_context5.next=11;break;case 8:_context5.prev=8;_context5.t0=_context5[\"catch\"](2);dispatch({type:FORGOT_PASSWORD,payload:{email:email,state:\"failed\"}});case 11:case\"end\":return _context5.stop();}}},_callee5,null,[[2,8]]);}));return function(_x8,_x9){return _ref5.apply(this,arguments);};}();};export var setResetPassword=function setResetPassword(mount,password,confirmPassword,state){if(mount){return{type:RESET_PASSWORD_DATA,payload:{password:password,confirmPassword:confirmPassword,state:state}};}else{return{type:RESET_PASSWORD_DATA,payload:null};}};export var resetPassword=function resetPassword(token){return/*#__PURE__*/function(){var _ref6=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(dispatch,getState){var _getState4,resetPasswordData,user;return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_getState4=getState(),resetPasswordData=_getState4.resetPasswordData;dispatch({type:RESET_PASSWORD_DATA,payload:_objectSpread(_objectSpread({},resetPasswordData),{},{state:\"submitting\"})});_context6.prev=2;_context6.next=5;return axios.patch(\"/api/v1/users/resetPassword/\".concat(token),resetPasswordData);case 5:user=_context6.sent;dispatch({type:AUTH_USER,payload:{token:user.data.token,user:user.data.user}});saveToken(user.data.token);history.push(\"/conversations\");loadDataHelper(dispatch,user.data.token,true,true,user.data.user);_context6.next=15;break;case 12:_context6.prev=12;_context6.t0=_context6[\"catch\"](2);dispatch({type:RESET_PASSWORD_DATA,payload:_objectSpread(_objectSpread({},resetPasswordData),{},{state:newUserDataState.invalidToken})});case 15:case\"end\":return _context6.stop();}}},_callee6,null,[[2,12]]);}));return function(_x10,_x11){return _ref6.apply(this,arguments);};}();};export var setActiveConversation=function setActiveConversation(conversation){return{type:ACTIVE_CONVERSATION,payload:conversation};};export var createConversation=function createConversation(id){return/*#__PURE__*/function(){var _ref7=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(dispatch,getState){var _getState5,auth,token;return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_getState5=getState(),auth=_getState5.auth;token=localStorage.getItem(\"token\");dispatch({type:ACTIVE_CONVERSATION,payload:{state:\"creating\",id:id}});_context7.prev=3;_context7.next=6;return axios.post(\"/api/v1/conversations\",{user1:auth.user._id,user2:id,createdAt:Date.now()},{headers:{authorization:\"Bearer \".concat(token)}});case 6:_context7.next=11;break;case 8:_context7.prev=8;_context7.t0=_context7[\"catch\"](3);dispatch({type:ACTIVE_CONVERSATION,payload:{state:\"failed\"}});case 11:case\"end\":return _context7.stop();}}},_callee7,null,[[3,8]]);}));return function(_x12,_x13){return _ref7.apply(this,arguments);};}();};export var setMessageData=function setMessageData(message,state){return{type:MESSAGE_DATA,payload:{message:message,state:state}};};export var sendMessage=function sendMessage(){return/*#__PURE__*/function(){var _ref8=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(dispatch,getState){var _getState6,message,auth,activeConversation,token;return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_getState6=getState(),message=_getState6.message,auth=_getState6.auth,activeConversation=_getState6.activeConversation;token=localStorage.getItem(\"token\");dispatch({type:MESSAGE_DATA,payload:{message:message.message,state:\"submitting\"}});_context8.prev=3;_context8.next=6;return axios.post(\"/api/v1/messages\",{conversation:activeConversation._id,user:auth.user._id,message:message.message,createdAt:Date.now()},{headers:{authorization:\"Bearer \".concat(token)}});case 6:dispatch({type:MESSAGE_DATA,payload:{message:\"\",state:\"submitted\"}});_context8.next=12;break;case 9:_context8.prev=9;_context8.t0=_context8[\"catch\"](3);dispatch({type:MESSAGE_DATA,payload:{message:message.message,state:\"failed\"}});case 12:case\"end\":return _context8.stop();}}},_callee8,null,[[3,9]]);}));return function(_x14,_x15){return _ref8.apply(this,arguments);};}();};export var userInserted=function userInserted(user){return function(dispatch,getState){var _getState7=getState(),users=_getState7.users;if(users.findIndex(function(sUser){return sUser._id===user._id;})===-1){var newUsers=[].concat(_toConsumableArray(users),[user]);dispatch({type:USERS,payload:_toConsumableArray(newUsers)});}};};export var userUpdated=function userUpdated(updates){return function(dispatch,getState){var _getState8=getState(),users=_getState8.users,auth=_getState8.auth;var updatedUser;var i=users.findIndex(function(user){return user._id===updates.id;});if(i<0)return;updatedUser=_objectSpread(_objectSpread({},users[i]),updates.updatedFields);if(auth.user._id===updates.id){dispatch({type:AUTH_USER,payload:_objectSpread(_objectSpread({},auth),{},{user:updatedUser})});}users=[].concat(_toConsumableArray(users.slice(0,i)),[updatedUser],_toConsumableArray(users.slice(i+1)));dispatch({type:USERS,payload:users});};};export var userDeleted=function userDeleted(id){return function(dispatch,getState){var _getState9=getState(),users=_getState9.users;var newUsers=users.filter(function(user){return user._id!==id;});dispatch({type:USERS,payload:_toConsumableArray(newUsers)});};};export var conversationInserted=function conversationInserted(doc){return function(dispatch,getState){var _getState10=getState(),conversations=_getState10.conversations,auth=_getState10.auth,activeConversation=_getState10.activeConversation;// insert conversation only if it is for auth user\nif(doc.user1===auth.user._id||doc.user2===auth.user._id){if(conversations.data.findIndex(function(con){return con._id===doc._id;})===-1){conversations.data=[].concat(_toConsumableArray(conversations.data),[doc]);var count=0;conversations.data.forEach(function(con){var lastMsg=con.messages[con.messages.length-1];if(!lastMsg||lastMsg.user!==auth.user._id){count++;}});dispatch({type:CONVERSATIONS,payload:{data:_toConsumableArray(conversations.data),notifications:count}});if(activeConversation&&activeConversation.id){dispatch({type:ACTIVE_CONVERSATION,payload:doc});}}}};};export var conversationDeleted=function conversationDeleted(data){return function(dispatch,getState){var _getState11=getState(),conversations=_getState11.conversations,auth=_getState11.auth,activeConversation=_getState11.activeConversation;if(activeConversation&&activeConversation._id===data._id){dispatch({type:ACTIVE_CONVERSATION,payload:null});}conversations.data=conversations.data.filter(function(con){return con._id!==data._id;});var count=0;conversations.data.forEach(function(con){var lastMsg=con.messages[con.messages.length-1];if(!lastMsg||lastMsg.user!==auth.user._id){count++;}});dispatch({type:CONVERSATIONS,payload:{data:_toConsumableArray(conversations.data),notifications:count}});};};export var messageInserted=function messageInserted(doc){return function(dispatch,getState){var _getState12=getState(),conversations=_getState12.conversations,auth=_getState12.auth;var i=conversations.data.findIndex(function(con){return con._id===doc.conversation;});if(i>=0){if(conversations.data[i].messages.findIndex(function(el){return el._id===doc._id;})===-1){conversations.data[i].messages=[].concat(_toConsumableArray(conversations.data[i].messages),[doc]);var newConversations=_toConsumableArray(conversations.data);var count=0;newConversations.forEach(function(con){var lastMsg=con.messages[con.messages.length-1];if(!lastMsg||lastMsg.user!==auth.user._id){count++;}});dispatch({type:CONVERSATIONS,payload:{data:newConversations,notifications:count}});if(doc.user===auth.user._id){dispatch({type:ACTIVE_CONVERSATION,payload:newConversations[i]});}}}};};export var addEmoji=function addEmoji(id){return function(dispatch,getState){var _getState13=getState(),message=_getState13.message;var emoji=EMOJIS.slice(id,id+2);dispatch({type:MESSAGE_DATA,payload:_objectSpread(_objectSpread({},message),{},{message:message.message+emoji})});};};export var setProfileData=function setProfileData(username,email){return{type:PROFILE_DATA,payload:{username:username,email:email}};};export var saveProfileData=function saveProfileData(){return/*#__PURE__*/function(){var _ref9=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(dispatch,getState){var _getState14,profileData,userAvatar,formData,token;return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_getState14=getState(),profileData=_getState14.profileData;userAvatar=document.querySelector(\".user-avatar\");formData=new FormData();formData.append(\"username\",profileData.username);formData.append(\"email\",profileData.email);if(userAvatar.files.length){formData.append(\"avatar\",userAvatar.files[0]);}dispatch({type:PROFILE_DATA,payload:_objectSpread(_objectSpread({},profileData),{},{state:\"saving\"})});token=localStorage.getItem(\"token\");_context9.prev=8;_context9.next=11;return axios.patch(\"/api/v1/users/updateMe\",formData,{headers:{authorization:\"Bearer \".concat(token)}});case 11:dispatch({type:PROFILE_DATA,payload:_objectSpread(_objectSpread({},profileData),{},{state:\"saved\"})});setTimeout(function(){dispatch({type:PROFILE_DATA,payload:_objectSpread(_objectSpread({},profileData),{},{state:\"\"})});},3000);if(userAvatar.files.length)window.location.reload();_context9.next=20;break;case 16:_context9.prev=16;_context9.t0=_context9[\"catch\"](8);dispatch({type:PROFILE_DATA,payload:_objectSpread(_objectSpread({},profileData),{},{state:\"failed\"})});console.log(_context9.t0);case 20:case\"end\":return _context9.stop();}}},_callee9,null,[[8,16]]);}));return function(_x16,_x17){return _ref9.apply(this,arguments);};}();};export var setChangePasswordData=function setChangePasswordData(currentPassword,newPassword,confirmPassword){return{type:CHANGE_PASSWORD,payload:{currentPassword:currentPassword,newPassword:newPassword,confirmPassword:confirmPassword}};};export var saveNewPassword=function saveNewPassword(){return/*#__PURE__*/function(){var _ref10=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(dispatch,getState){var _getState15,changePassword,token,user;return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_getState15=getState(),changePassword=_getState15.changePassword;if(!(changePassword.newPassword.length<12)){_context10.next=6;break;}dispatch({type:CHANGE_PASSWORD,payload:_objectSpread(_objectSpread({},changePassword),{},{state:\"validation,New password length should be greater than 12.\"})});return _context10.abrupt(\"return\");case 6:if(!(changePassword.newPassword!==changePassword.confirmPassword)){_context10.next=9;break;}dispatch({type:CHANGE_PASSWORD,payload:_objectSpread(_objectSpread({},changePassword),{},{state:\"validation,New password and Confirm password are not same.\"})});return _context10.abrupt(\"return\");case 9:dispatch({type:CHANGE_PASSWORD,payload:_objectSpread(_objectSpread({},changePassword),{},{state:\"saving\"})});token=localStorage.getItem(\"token\");_context10.prev=11;_context10.next=14;return axios.patch(\"/api/v1/users/updatePassword\",changePassword,{headers:{authorization:\"Bearer \".concat(token)}});case 14:user=_context10.sent;saveToken(user.data.token);dispatch({type:CHANGE_PASSWORD,payload:{currentPassword:\"\",newPassword:\"\",confirmPassword:\"\",state:\"saved\"}});setTimeout(function(){dispatch({type:CHANGE_PASSWORD,payload:{currentPassword:\"\",newPassword:\"\",confirmPassword:\"\",state:\"\"}});},3000);_context10.next=23;break;case 20:_context10.prev=20;_context10.t0=_context10[\"catch\"](11);dispatch({type:CHANGE_PASSWORD,payload:_objectSpread(_objectSpread({},changePassword),{},{state:\"failed\"})});case 23:case\"end\":return _context10.stop();}}},_callee10,null,[[11,20]]);}));return function(_x18,_x19){return _ref10.apply(this,arguments);};}();};export var logout=function logout(){return/*#__PURE__*/function(){var _ref11=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(dispatch,getState){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:dispatch({type:AUTH_USER,payload:{}});dispatch({type:CONVERSATIONS,payload:{data:[],notifications:0}});dispatch({type:USERS,payload:[]});localStorage.setItem(\"token\",\"\");_context11.next=6;return axios.get(\"/api/v1/users/logout\");case 6:case\"end\":return _context11.stop();}}},_callee11);}));return function(_x20,_x21){return _ref11.apply(this,arguments);};}();};export var deleteAccount=function deleteAccount(){return/*#__PURE__*/function(){var _ref12=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee12(dispatch,getState){var token;return _regeneratorRuntime.wrap(function _callee12$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:token=localStorage.getItem(\"token\");_context12.prev=1;_context12.next=4;return axios.delete(\"/api/v1/users/deleteMe\",{headers:{authorization:\"Bearer \".concat(token)}});case 4:history.push(root);_context12.next=10;break;case 7:_context12.prev=7;_context12.t0=_context12[\"catch\"](1);console.log(_context12.t0);case 10:case\"end\":return _context12.stop();}}},_callee12,null,[[1,7]]);}));return function(_x22,_x23){return _ref12.apply(this,arguments);};}();};export var loadData=function loadData(){return/*#__PURE__*/function(){var _ref13=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee13(dispatch){var token;return _regeneratorRuntime.wrap(function _callee13$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:token=localStorage.getItem(\"token\");loadDataHelper(dispatch,token,true,true,false,true);case 2:case\"end\":return _context13.stop();}}},_callee13);}));return function(_x24){return _ref13.apply(this,arguments);};}();};","map":{"version":3,"sources":["C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/src/actions/index.js"],"names":["NEW_USER_DATA","newUserDataState","AUTH_USER","LOGIN_USER_DATA","FORGOT_PASSWORD","RESET_PASSWORD_DATA","CONVERSATIONS","USERS","ACTIVE_CONVERSATION","MESSAGE_DATA","PROFILE_DATA","CHANGE_PASSWORD","axios","history","emailConfirmation","root","EMOJIS","saveToken","loadDataHelper","setNewUserData","newUser","username","email","password","confirmPassword","state","type","payload","signupUser","dispatch","getState","newUserData","joinedAt","Date","now","post","submitted","push","failed","resendAccountActivateEmail","resubmitting","emailNotExist","activateAccount","token","activatingAccount","get","user","data","accountActivated","invalidToken","setLoginData","mount","loginUser","loginUserData","loginFailed","setForgotPassword","sendForgotPassword","forgotPassword","setResetPassword","resetPassword","resetPasswordData","patch","setActiveConversation","conversation","createConversation","id","auth","localStorage","getItem","user1","_id","user2","createdAt","headers","authorization","setMessageData","message","sendMessage","activeConversation","userInserted","users","findIndex","sUser","newUsers","userUpdated","updates","updatedUser","i","updatedFields","slice","userDeleted","filter","conversationInserted","doc","conversations","con","count","forEach","lastMsg","messages","length","notifications","conversationDeleted","messageInserted","el","newConversations","addEmoji","emoji","setProfileData","saveProfileData","profileData","userAvatar","document","querySelector","formData","FormData","append","files","setTimeout","window","location","reload","console","log","setChangePasswordData","currentPassword","newPassword","saveNewPassword","changePassword","logout","setItem","deleteAccount","delete","loadData"],"mappings":"gqBAAA,OACEA,aADF,CAEEC,gBAFF,CAGEC,SAHF,CAIEC,eAJF,CAKEC,eALF,CAMEC,mBANF,CAOEC,aAPF,CAQEC,KARF,CASEC,mBATF,CAUEC,YAVF,CAWEC,YAXF,CAYEC,eAZF,KAaO,SAbP,CAcA,MAAOC,CAAAA,KAAP,KAAkB,gBAAlB,CACA,MAAOC,CAAAA,OAAP,KAAoB,kBAApB,CACA,OAASC,iBAAT,CAA4BC,IAA5B,KAAwC,iBAAxC,CACA,MAAOC,CAAAA,MAAP,KAAmB,iBAAnB,CACA,OAASC,SAAT,CAAoBC,cAApB,KAA0C,UAA1C,CAEA,MAAO,IAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAC5BC,OAD4B,CAE5BC,QAF4B,CAG5BC,KAH4B,CAI5BC,QAJ4B,CAK5BC,eAL4B,CAM5BC,KAN4B,CAOzB,CACH,GAAIL,OAAJ,CAAa,CACX,MAAO,CACLM,IAAI,CAAE1B,aADD,CAEL2B,OAAO,CAAE,CACPN,QAAQ,CAARA,QADO,CAEPC,KAAK,CAALA,KAFO,CAGPC,QAAQ,CAARA,QAHO,CAIPC,eAAe,CAAfA,eAJO,CAKPC,KAAK,CAALA,KALO,CAFJ,CAAP,CAUD,CAXD,IAWO,CACL,MAAO,CACLC,IAAI,CAAE1B,aADD,CAEL2B,OAAO,CAAE,IAFJ,CAAP,CAID,CACF,CAzBM,CA2BP,MAAO,IAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,kGAAM,iBAAOC,QAAP,CAAiBC,QAAjB,sJACNA,QAAQ,EADF,CACtBC,WADsB,WACtBA,WADsB,CAE9BA,WAAW,CAACC,QAAZ,CAAuBC,IAAI,CAACC,GAAL,EAAvB,CAF8B,sCAKtBtB,CAAAA,KAAK,CAACuB,IAAN,CAAW,sBAAX,CAAmCJ,WAAnC,CALsB,QAM5BF,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,gCACFI,WADE,MAELN,KAAK,CAAExB,gBAAgB,CAACmC,SAFnB,EAFA,CAAD,CAAR,CAOAvB,OAAO,CAACwB,IAAR,CAAavB,iBAAb,EAb4B,+EAe5Be,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,gCACFI,WADE,MAELN,KAAK,CAAExB,gBAAgB,CAACqC,MAFnB,EAFA,CAAD,CAAR,CAf4B,oEAAN,oEAAnB,CAyBP,MAAO,IAAMC,CAAAA,0BAA0B,CAAG,QAA7BA,CAAAA,0BAA6B,mGAAM,kBAAOV,QAAP,CAAiBC,QAAjB,4JACtBA,QAAQ,EADc,CACtCC,WADsC,YACtCA,WADsC,CAG9CF,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,gCACFI,WADE,MAELN,KAAK,CAAExB,gBAAgB,CAACuC,YAFnB,EAFA,CAAD,CAAR,CAH8C,wCAYtC5B,CAAAA,KAAK,CAACuB,IAAN,CAAW,oCAAX,CAAiD,CACrDb,KAAK,CAAES,WAAW,CAACT,KADkC,CAAjD,CAZsC,QAe5CO,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,gCACFI,WADE,MAELN,KAAK,CAAExB,gBAAgB,CAACmC,SAFnB,EAFA,CAAD,CAAR,CAOAvB,OAAO,CAACwB,IAAR,CAAavB,iBAAb,EAtB4C,mFAwB5Ce,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,gCACFI,WADE,MAELN,KAAK,CAAExB,gBAAgB,CAACwC,aAFnB,EAFA,CAAD,CAAR,CAxB4C,sEAAN,sEAAnC,CAkCP,MAAO,IAAMC,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACC,KAAD,kGAAW,kBAAOd,QAAP,+HACxCA,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,CAAE,CACPN,QAAQ,CAAE,EADH,CAEPC,KAAK,CAAE,EAFA,CAGPC,QAAQ,CAAE,EAHH,CAIPC,eAAe,CAAE,EAJV,CAKPC,KAAK,CAAExB,gBAAgB,CAAC2C,iBALjB,CAFF,CAAD,CAAR,CADwC,wCAYnBhC,CAAAA,KAAK,CAACiC,GAAN,yCAA2CF,KAA3C,EAZmB,QAYhCG,IAZgC,gBActCjB,QAAQ,CAAC,CACPH,IAAI,CAAExB,SADC,CAEPyB,OAAO,CAAE,CACPgB,KAAK,CAAEG,IAAI,CAACC,IAAL,CAAUJ,KADV,CAEPG,IAAI,CAAEA,IAAI,CAACC,IAAL,CAAUD,IAFT,CAFF,CAAD,CAAR,CAQAjB,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,CAAE,CACPN,QAAQ,CAAE,EADH,CAEPC,KAAK,CAAE,EAFA,CAGPC,QAAQ,CAAE,EAHH,CAIPC,eAAe,CAAE,EAJV,CAKPC,KAAK,CAAExB,gBAAgB,CAAC+C,gBALjB,CAFF,CAAD,CAAR,CAWA/B,SAAS,CAAC6B,IAAI,CAACC,IAAL,CAAUJ,KAAX,CAAT,CAEA9B,OAAO,CAACwB,IAAR,CAAa,gBAAb,EAEAnB,cAAc,CAACW,QAAD,CAAWiB,IAAI,CAACC,IAAL,CAAUJ,KAArB,CAA4B,IAA5B,CAAkC,IAAlC,CAAwCG,IAAI,CAACC,IAAL,CAAUD,IAAlD,CAAd,CArCsC,qFAuCtCjB,QAAQ,CAAC,CACPH,IAAI,CAAE1B,aADC,CAEP2B,OAAO,CAAE,CACPN,QAAQ,CAAE,EADH,CAEPC,KAAK,CAAE,EAFA,CAGPC,QAAQ,CAAE,EAHH,CAIPC,eAAe,CAAE,EAJV,CAKPC,KAAK,CAAExB,gBAAgB,CAACgD,YALjB,CAFF,CAAD,CAAR,CAvCsC,uEAAX,kEAAxB,CAoDP,MAAO,IAAMC,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACC,KAAD,CAAQ7B,KAAR,CAAeC,QAAf,CAA4B,CACtD,GAAI4B,KAAJ,CAAW,CACT,MAAO,CACLzB,IAAI,CAAEvB,eADD,CAELwB,OAAO,CAAE,CACPL,KAAK,CAALA,KADO,CAEPC,QAAQ,CAARA,QAFO,CAFJ,CAAP,CAOD,CARD,IAQO,CACL,MAAO,CACLG,IAAI,CAAEvB,eADD,CAELwB,OAAO,CAAE,IAFJ,CAAP,CAID,CACF,CAfM,CAiBP,MAAO,IAAMyB,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,mGAAM,kBAAOvB,QAAP,CAAiBC,QAAjB,mKACHA,QAAQ,EADL,CACrBuB,aADqB,YACrBA,aADqB,CAG7BxB,QAAQ,CAAC,CACPH,IAAI,CAAEvB,eADC,CAEPwB,OAAO,gCACF0B,aADE,MAEL5B,KAAK,CAAE,YAFF,EAFA,CAAD,CAAR,CAH6B,wCAYRb,CAAAA,KAAK,CAACuB,IAAN,CAAW,qBAAX,CAAkCkB,aAAlC,CAZQ,QAYrBP,IAZqB,gBAc3BjB,QAAQ,CAAC,CACPH,IAAI,CAAExB,SADC,CAEPyB,OAAO,CAAE,CACPmB,IAAI,CAAEA,IAAI,CAACC,IAAL,CAAUD,IADT,CAFF,CAAD,CAAR,CAOA7B,SAAS,CAAC6B,IAAI,CAACC,IAAL,CAAUJ,KAAX,CAAT,CAEA9B,OAAO,CAACwB,IAAR,CAAa,gBAAb,EAEAnB,cAAc,CAACW,QAAD,CAAWiB,IAAI,CAACC,IAAL,CAAUJ,KAArB,CAA4B,IAA5B,CAAkC,IAAlC,CAAwCG,IAAI,CAACC,IAAL,CAAUD,IAAlD,CAAd,CAzB2B,qFA2B3BjB,QAAQ,CAAC,CACPH,IAAI,CAAEvB,eADC,CAEPwB,OAAO,gCACF0B,aADE,MAELC,WAAW,CAAE,IAFR,CAGL7B,KAAK,CAAE,QAHF,EAFA,CAAD,CAAR,CA3B2B,uEAAN,sEAAlB,CAsCP,MAAO,IAAM8B,CAAAA,iBAAiB,CAAG,QAApBA,CAAAA,iBAAoB,CAACjC,KAAD,CAAQG,KAAR,CAAe0B,KAAf,CAAyB,CACxD,GAAIA,KAAJ,CAAW,CACT,MAAO,CACLzB,IAAI,CAAEtB,eADD,CAELuB,OAAO,CAAE,CACPL,KAAK,CAALA,KADO,CAEPG,KAAK,CAALA,KAFO,CAFJ,CAAP,CAOD,CARD,IAQO,CACL,MAAO,CACLC,IAAI,CAAEtB,eADD,CAELuB,OAAO,CAAE,IAFJ,CAAP,CAID,CACF,CAfM,CAiBP,MAAO,IAAM6B,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,mGAAM,kBAAO3B,QAAP,CAAiBC,QAAjB,gIAC9BR,KAD8B,CACpBQ,QAAQ,GAAG2B,cADS,CAC9BnC,KAD8B,CAGtCO,QAAQ,CAAC,CACPH,IAAI,CAAEtB,eADC,CAEPuB,OAAO,CAAE,CACPL,KAAK,CAALA,KADO,CAEPG,KAAK,CAAE,YAFA,CAFF,CAAD,CAAR,CAHsC,wCAY9Bb,CAAAA,KAAK,CAACuB,IAAN,CAAW,8BAAX,CAA2C,CAAEb,KAAK,CAALA,KAAF,CAA3C,CAZ8B,QAapCO,QAAQ,CAAC,CACPH,IAAI,CAAEtB,eADC,CAEPuB,OAAO,CAAE,CACPL,KAAK,CAALA,KADO,CAEPG,KAAK,CAAE,WAFA,CAFF,CAAD,CAAR,CAboC,mFAqBpCI,QAAQ,CAAC,CACPH,IAAI,CAAEtB,eADC,CAEPuB,OAAO,CAAE,CACPL,KAAK,CAALA,KADO,CAEPG,KAAK,CAAE,QAFA,CAFF,CAAD,CAAR,CArBoC,sEAAN,sEAA3B,CA+BP,MAAO,IAAMiC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,CAACP,KAAD,CAAQ5B,QAAR,CAAkBC,eAAlB,CAAmCC,KAAnC,CAA6C,CAC3E,GAAI0B,KAAJ,CAAW,CACT,MAAO,CACLzB,IAAI,CAAErB,mBADD,CAELsB,OAAO,CAAE,CACPJ,QAAQ,CAARA,QADO,CAEPC,eAAe,CAAfA,eAFO,CAGPC,KAAK,CAALA,KAHO,CAFJ,CAAP,CAQD,CATD,IASO,CACL,MAAO,CACLC,IAAI,CAAErB,mBADD,CAELsB,OAAO,CAAE,IAFJ,CAAP,CAID,CACF,CAhBM,CAkBP,MAAO,IAAMgC,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,CAAChB,KAAD,kGAAW,kBAAOd,QAAP,CAAiBC,QAAjB,uKACRA,QAAQ,EADA,CAC9B8B,iBAD8B,YAC9BA,iBAD8B,CAGtC/B,QAAQ,CAAC,CACPH,IAAI,CAAErB,mBADC,CAEPsB,OAAO,gCACFiC,iBADE,MAELnC,KAAK,CAAE,YAFF,EAFA,CAAD,CAAR,CAHsC,wCAYjBb,CAAAA,KAAK,CAACiD,KAAN,uCACclB,KADd,EAEjBiB,iBAFiB,CAZiB,QAY9Bd,IAZ8B,gBAiBpCjB,QAAQ,CAAC,CACPH,IAAI,CAAExB,SADC,CAEPyB,OAAO,CAAE,CACPgB,KAAK,CAAEG,IAAI,CAACC,IAAL,CAAUJ,KADV,CAEPG,IAAI,CAAEA,IAAI,CAACC,IAAL,CAAUD,IAFT,CAFF,CAAD,CAAR,CAQA7B,SAAS,CAAC6B,IAAI,CAACC,IAAL,CAAUJ,KAAX,CAAT,CAEA9B,OAAO,CAACwB,IAAR,CAAa,gBAAb,EAEAnB,cAAc,CAACW,QAAD,CAAWiB,IAAI,CAACC,IAAL,CAAUJ,KAArB,CAA4B,IAA5B,CAAkC,IAAlC,CAAwCG,IAAI,CAACC,IAAL,CAAUD,IAAlD,CAAd,CA7BoC,qFA+BpCjB,QAAQ,CAAC,CACPH,IAAI,CAAErB,mBADC,CAEPsB,OAAO,gCACFiC,iBADE,MAELnC,KAAK,CAAExB,gBAAgB,CAACgD,YAFnB,EAFA,CAAD,CAAR,CA/BoC,uEAAX,wEAAtB,CAyCP,MAAO,IAAMa,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CAACC,YAAD,CAAkB,CACrD,MAAO,CACLrC,IAAI,CAAElB,mBADD,CAELmB,OAAO,CAAEoC,YAFJ,CAAP,CAID,CALM,CAOP,MAAO,IAAMC,CAAAA,kBAAkB,CAAG,QAArBA,CAAAA,kBAAqB,CAACC,EAAD,kGAAQ,kBAAOpC,QAAP,CAAiBC,QAAjB,2JACvBA,QAAQ,EADe,CAChCoC,IADgC,YAChCA,IADgC,CAGlCvB,KAHkC,CAG1BwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAH0B,CAKxCvC,QAAQ,CAAC,CACPH,IAAI,CAAElB,mBADC,CAEPmB,OAAO,CAAE,CACPF,KAAK,CAAE,UADA,CAEPwC,EAAE,CAAFA,EAFO,CAFF,CAAD,CAAR,CALwC,wCAchCrD,CAAAA,KAAK,CAACuB,IAAN,CACJ,uBADI,CAEJ,CAAEkC,KAAK,CAAEH,IAAI,CAACpB,IAAL,CAAUwB,GAAnB,CAAwBC,KAAK,CAAEN,EAA/B,CAAmCO,SAAS,CAAEvC,IAAI,CAACC,GAAL,EAA9C,CAFI,CAGJ,CACEuC,OAAO,CAAE,CACPC,aAAa,kBAAY/B,KAAZ,CADN,CADX,CAHI,CAdgC,2FAwBtCd,QAAQ,CAAC,CACPH,IAAI,CAAElB,mBADC,CAEPmB,OAAO,CAAE,CACPF,KAAK,CAAE,QADA,CAFF,CAAD,CAAR,CAxBsC,sEAAR,wEAA3B,CAiCP,MAAO,IAAMkD,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACC,OAAD,CAAUnD,KAAV,CAAoB,CAChD,MAAO,CACLC,IAAI,CAAEjB,YADD,CAELkB,OAAO,CAAE,CACPiD,OAAO,CAAPA,OADO,CAEPnD,KAAK,CAALA,KAFO,CAFJ,CAAP,CAOD,CARM,CAUP,MAAO,IAAMoD,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,mGAAM,kBAAOhD,QAAP,CAAiBC,QAAjB,sLACeA,QAAQ,EADvB,CACvB8C,OADuB,YACvBA,OADuB,CACdV,IADc,YACdA,IADc,CACRY,kBADQ,YACRA,kBADQ,CAGzBnC,KAHyB,CAGjBwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CAHiB,CAK/BvC,QAAQ,CAAC,CACPH,IAAI,CAAEjB,YADC,CAEPkB,OAAO,CAAE,CACPiD,OAAO,CAAEA,OAAO,CAACA,OADV,CAEPnD,KAAK,CAAE,YAFA,CAFF,CAAD,CAAR,CAL+B,wCAcvBb,CAAAA,KAAK,CAACuB,IAAN,CACJ,kBADI,CAEJ,CACE4B,YAAY,CAAEe,kBAAkB,CAACR,GADnC,CAEExB,IAAI,CAAEoB,IAAI,CAACpB,IAAL,CAAUwB,GAFlB,CAGEM,OAAO,CAAEA,OAAO,CAACA,OAHnB,CAIEJ,SAAS,CAAEvC,IAAI,CAACC,GAAL,EAJb,CAFI,CAQJ,CACEuC,OAAO,CAAE,CACPC,aAAa,kBAAY/B,KAAZ,CADN,CADX,CARI,CAduB,QA6B7Bd,QAAQ,CAAC,CACPH,IAAI,CAAEjB,YADC,CAEPkB,OAAO,CAAE,CACPiD,OAAO,CAAE,EADF,CAEPnD,KAAK,CAAE,WAFA,CAFF,CAAD,CAAR,CA7B6B,mFAqC7BI,QAAQ,CAAC,CACPH,IAAI,CAAEjB,YADC,CAEPkB,OAAO,CAAE,CACPiD,OAAO,CAAEA,OAAO,CAACA,OADV,CAEPnD,KAAK,CAAE,QAFA,CAFF,CAAD,CAAR,CArC6B,sEAAN,wEAApB,CA+CP,MAAO,IAAMsD,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACjC,IAAD,QAAU,UAACjB,QAAD,CAAWC,QAAX,CAAwB,gBAC1CA,QAAQ,EADkC,CACpDkD,KADoD,YACpDA,KADoD,CAE5D,GAAIA,KAAK,CAACC,SAAN,CAAgB,SAACC,KAAD,QAAWA,CAAAA,KAAK,CAACZ,GAAN,GAAcxB,IAAI,CAACwB,GAA9B,EAAhB,IAAuD,CAAC,CAA5D,CAA+D,CAC7D,GAAMa,CAAAA,QAAQ,8BAAOH,KAAP,GAAclC,IAAd,EAAd,CAEAjB,QAAQ,CAAC,CACPH,IAAI,CAAEnB,KADC,CAEPoB,OAAO,oBAAMwD,QAAN,CAFA,CAAD,CAAR,CAID,CACF,CAV2B,EAArB,CAYP,MAAO,IAAMC,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,OAAD,QAAa,UAACxD,QAAD,CAAWC,QAAX,CAAwB,gBACxCA,QAAQ,EADgC,CACxDkD,KADwD,YACxDA,KADwD,CACjDd,IADiD,YACjDA,IADiD,CAG9D,GAAIoB,CAAAA,WAAJ,CACA,GAAIC,CAAAA,CAAC,CAAGP,KAAK,CAACC,SAAN,CAAgB,SAACnC,IAAD,QAAUA,CAAAA,IAAI,CAACwB,GAAL,GAAae,OAAO,CAACpB,EAA/B,EAAhB,CAAR,CAEA,GAAIsB,CAAC,CAAG,CAAR,CAAW,OAEXD,WAAW,gCACNN,KAAK,CAACO,CAAD,CADC,EAENF,OAAO,CAACG,aAFF,CAAX,CAKA,GAAItB,IAAI,CAACpB,IAAL,CAAUwB,GAAV,GAAkBe,OAAO,CAACpB,EAA9B,CAAkC,CAChCpC,QAAQ,CAAC,CACPH,IAAI,CAAExB,SADC,CAEPyB,OAAO,gCACFuC,IADE,MAELpB,IAAI,CAAEwC,WAFD,EAFA,CAAD,CAAR,CAOD,CAEDN,KAAK,8BAAOA,KAAK,CAACS,KAAN,CAAY,CAAZ,CAAeF,CAAf,CAAP,GAA0BD,WAA1B,qBAA0CN,KAAK,CAACS,KAAN,CAAYF,CAAC,CAAG,CAAhB,CAA1C,EAAL,CAEA1D,QAAQ,CAAC,CACPH,IAAI,CAAEnB,KADC,CAEPoB,OAAO,CAAEqD,KAFF,CAAD,CAAR,CAID,CA7B0B,EAApB,CA+BP,MAAO,IAAMU,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACzB,EAAD,QAAQ,UAACpC,QAAD,CAAWC,QAAX,CAAwB,gBACvCA,QAAQ,EAD+B,CACjDkD,KADiD,YACjDA,KADiD,CAGzD,GAAMG,CAAAA,QAAQ,CAAGH,KAAK,CAACW,MAAN,CAAa,SAAC7C,IAAD,QAAUA,CAAAA,IAAI,CAACwB,GAAL,GAAaL,EAAvB,EAAb,CAAjB,CAEApC,QAAQ,CAAC,CACPH,IAAI,CAAEnB,KADC,CAEPoB,OAAO,oBAAMwD,QAAN,CAFA,CAAD,CAAR,CAID,CAT0B,EAApB,CAWP,MAAO,IAAMS,CAAAA,oBAAoB,CAAG,QAAvBA,CAAAA,oBAAuB,CAACC,GAAD,QAAS,UAAChE,QAAD,CAAWC,QAAX,CAAwB,iBACjBA,QAAQ,EADS,CAC7DgE,aAD6D,aAC7DA,aAD6D,CAC9C5B,IAD8C,aAC9CA,IAD8C,CACxCY,kBADwC,aACxCA,kBADwC,CAGnE;AACA,GAAIe,GAAG,CAACxB,KAAJ,GAAcH,IAAI,CAACpB,IAAL,CAAUwB,GAAxB,EAA+BuB,GAAG,CAACtB,KAAJ,GAAcL,IAAI,CAACpB,IAAL,CAAUwB,GAA3D,CAAgE,CAC9D,GAAIwB,aAAa,CAAC/C,IAAd,CAAmBkC,SAAnB,CAA6B,SAACc,GAAD,QAASA,CAAAA,GAAG,CAACzB,GAAJ,GAAYuB,GAAG,CAACvB,GAAzB,EAA7B,IAA+D,CAAC,CAApE,CAAuE,CACrEwB,aAAa,CAAC/C,IAAd,8BAAyB+C,aAAa,CAAC/C,IAAvC,GAA6C8C,GAA7C,GAEA,GAAIG,CAAAA,KAAK,CAAG,CAAZ,CACAF,aAAa,CAAC/C,IAAd,CAAmBkD,OAAnB,CAA2B,SAACF,GAAD,CAAS,CAClC,GAAMG,CAAAA,OAAO,CAAGH,GAAG,CAACI,QAAJ,CAAaJ,GAAG,CAACI,QAAJ,CAAaC,MAAb,CAAsB,CAAnC,CAAhB,CAEA,GAAI,CAACF,OAAD,EAAYA,OAAO,CAACpD,IAAR,GAAiBoB,IAAI,CAACpB,IAAL,CAAUwB,GAA3C,CAAgD,CAC9C0B,KAAK,GACN,CACF,CAND,EAQAnE,QAAQ,CAAC,CACPH,IAAI,CAAEpB,aADC,CAEPqB,OAAO,CAAE,CACPoB,IAAI,oBAAM+C,aAAa,CAAC/C,IAApB,CADG,CAEPsD,aAAa,CAAEL,KAFR,CAFF,CAAD,CAAR,CAQA,GAAIlB,kBAAkB,EAAIA,kBAAkB,CAACb,EAA7C,CAAiD,CAC/CpC,QAAQ,CAAC,CACPH,IAAI,CAAElB,mBADC,CAEPmB,OAAO,CAAEkE,GAFF,CAAD,CAAR,CAID,CACF,CACF,CACF,CAjCmC,EAA7B,CAmCP,MAAO,IAAMS,CAAAA,mBAAmB,CAAG,QAAtBA,CAAAA,mBAAsB,CAACvD,IAAD,QAAU,UAAClB,QAAD,CAAWC,QAAX,CAAwB,iBACjBA,QAAQ,EADS,CAC7DgE,aAD6D,aAC7DA,aAD6D,CAC9C5B,IAD8C,aAC9CA,IAD8C,CACxCY,kBADwC,aACxCA,kBADwC,CAGnE,GAAIA,kBAAkB,EAAIA,kBAAkB,CAACR,GAAnB,GAA2BvB,IAAI,CAACuB,GAA1D,CAA+D,CAC7DzC,QAAQ,CAAC,CACPH,IAAI,CAAElB,mBADC,CAEPmB,OAAO,CAAE,IAFF,CAAD,CAAR,CAID,CAEDmE,aAAa,CAAC/C,IAAd,CAAqB+C,aAAa,CAAC/C,IAAd,CAAmB4C,MAAnB,CAA0B,SAACI,GAAD,QAASA,CAAAA,GAAG,CAACzB,GAAJ,GAAYvB,IAAI,CAACuB,GAA1B,EAA1B,CAArB,CAEA,GAAI0B,CAAAA,KAAK,CAAG,CAAZ,CACAF,aAAa,CAAC/C,IAAd,CAAmBkD,OAAnB,CAA2B,SAACF,GAAD,CAAS,CAClC,GAAMG,CAAAA,OAAO,CAAGH,GAAG,CAACI,QAAJ,CAAaJ,GAAG,CAACI,QAAJ,CAAaC,MAAb,CAAsB,CAAnC,CAAhB,CAEA,GAAI,CAACF,OAAD,EAAYA,OAAO,CAACpD,IAAR,GAAiBoB,IAAI,CAACpB,IAAL,CAAUwB,GAA3C,CAAgD,CAC9C0B,KAAK,GACN,CACF,CAND,EAQAnE,QAAQ,CAAC,CACPH,IAAI,CAAEpB,aADC,CAEPqB,OAAO,CAAE,CACPoB,IAAI,oBAAM+C,aAAa,CAAC/C,IAApB,CADG,CAEPsD,aAAa,CAAEL,KAFR,CAFF,CAAD,CAAR,CAOD,CA5BkC,EAA5B,CA8BP,MAAO,IAAMO,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,CAACV,GAAD,QAAS,UAAChE,QAAD,CAAWC,QAAX,CAAwB,iBAC9BA,QAAQ,EADsB,CACtDgE,aADsD,aACtDA,aADsD,CACvC5B,IADuC,aACvCA,IADuC,CAG9D,GAAIqB,CAAAA,CAAC,CAAGO,aAAa,CAAC/C,IAAd,CAAmBkC,SAAnB,CAA6B,SAACc,GAAD,QAASA,CAAAA,GAAG,CAACzB,GAAJ,GAAYuB,GAAG,CAAC9B,YAAzB,EAA7B,CAAR,CAEA,GAAIwB,CAAC,EAAI,CAAT,CAAY,CACV,GACEO,aAAa,CAAC/C,IAAd,CAAmBwC,CAAnB,EAAsBY,QAAtB,CAA+BlB,SAA/B,CAAyC,SAACuB,EAAD,QAAQA,CAAAA,EAAE,CAAClC,GAAH,GAAWuB,GAAG,CAACvB,GAAvB,EAAzC,IACA,CAAC,CAFH,CAGE,CACAwB,aAAa,CAAC/C,IAAd,CAAmBwC,CAAnB,EAAsBY,QAAtB,8BAAqCL,aAAa,CAAC/C,IAAd,CAAmBwC,CAAnB,EAAsBY,QAA3D,GAAqEN,GAArE,GAEA,GAAMY,CAAAA,gBAAgB,oBAAOX,aAAa,CAAC/C,IAArB,CAAtB,CAEA,GAAIiD,CAAAA,KAAK,CAAG,CAAZ,CACAS,gBAAgB,CAACR,OAAjB,CAAyB,SAACF,GAAD,CAAS,CAChC,GAAMG,CAAAA,OAAO,CAAGH,GAAG,CAACI,QAAJ,CAAaJ,GAAG,CAACI,QAAJ,CAAaC,MAAb,CAAsB,CAAnC,CAAhB,CAEA,GAAI,CAACF,OAAD,EAAYA,OAAO,CAACpD,IAAR,GAAiBoB,IAAI,CAACpB,IAAL,CAAUwB,GAA3C,CAAgD,CAC9C0B,KAAK,GACN,CACF,CAND,EAQAnE,QAAQ,CAAC,CACPH,IAAI,CAAEpB,aADC,CAEPqB,OAAO,CAAE,CACPoB,IAAI,CAAE0D,gBADC,CAEPJ,aAAa,CAAEL,KAFR,CAFF,CAAD,CAAR,CAQA,GAAIH,GAAG,CAAC/C,IAAJ,GAAaoB,IAAI,CAACpB,IAAL,CAAUwB,GAA3B,CAAgC,CAC9BzC,QAAQ,CAAC,CACPH,IAAI,CAAElB,mBADC,CAEPmB,OAAO,CAAE8E,gBAAgB,CAAClB,CAAD,CAFlB,CAAD,CAAR,CAID,CACF,CACF,CACF,CAvC8B,EAAxB,CAyCP,MAAO,IAAMmB,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,CAACzC,EAAD,QAAQ,UAACpC,QAAD,CAAWC,QAAX,CAAwB,iBAClCA,QAAQ,EAD0B,CAC9C8C,OAD8C,aAC9CA,OAD8C,CAGtD,GAAI+B,CAAAA,KAAK,CAAG3F,MAAM,CAACyE,KAAP,CAAaxB,EAAb,CAAiBA,EAAE,CAAG,CAAtB,CAAZ,CAEApC,QAAQ,CAAC,CACPH,IAAI,CAAEjB,YADC,CAEPkB,OAAO,gCACFiD,OADE,MAELA,OAAO,CAAEA,OAAO,CAACA,OAAR,CAAkB+B,KAFtB,EAFA,CAAD,CAAR,CAOD,CAZuB,EAAjB,CAcP,MAAO,IAAMC,CAAAA,cAAc,CAAG,QAAjBA,CAAAA,cAAiB,CAACvF,QAAD,CAAWC,KAAX,CAAqB,CACjD,MAAO,CACLI,IAAI,CAAEhB,YADD,CAELiB,OAAO,CAAE,CACPN,QAAQ,CAARA,QADO,CAEPC,KAAK,CAALA,KAFO,CAFJ,CAAP,CAOD,CARM,CAUP,MAAO,IAAMuF,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,mGAAM,kBAAOhF,QAAP,CAAiBC,QAAjB,wLACXA,QAAQ,EADG,CAC3BgF,WAD2B,aAC3BA,WAD2B,CAG7BC,UAH6B,CAGhBC,QAAQ,CAACC,aAAT,CAAuB,cAAvB,CAHgB,CAI7BC,QAJ6B,CAIlB,GAAIC,CAAAA,QAAJ,EAJkB,CAKnCD,QAAQ,CAACE,MAAT,CAAgB,UAAhB,CAA4BN,WAAW,CAACzF,QAAxC,EACA6F,QAAQ,CAACE,MAAT,CAAgB,OAAhB,CAAyBN,WAAW,CAACxF,KAArC,EAEA,GAAIyF,UAAU,CAACM,KAAX,CAAiBjB,MAArB,CAA6B,CAC3Bc,QAAQ,CAACE,MAAT,CAAgB,QAAhB,CAA0BL,UAAU,CAACM,KAAX,CAAiB,CAAjB,CAA1B,EACD,CAEDxF,QAAQ,CAAC,CACPH,IAAI,CAAEhB,YADC,CAEPiB,OAAO,gCACFmF,WADE,MAELrF,KAAK,CAAE,QAFF,EAFA,CAAD,CAAR,CAQMkB,KApB6B,CAoBrBwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CApBqB,0CAuB3BxD,CAAAA,KAAK,CAACiD,KAAN,CAAY,wBAAZ,CAAsCqD,QAAtC,CAAgD,CACpDzC,OAAO,CAAE,CACPC,aAAa,kBAAY/B,KAAZ,CADN,CAD2C,CAAhD,CAvB2B,SA6BjCd,QAAQ,CAAC,CACPH,IAAI,CAAEhB,YADC,CAEPiB,OAAO,gCACFmF,WADE,MAELrF,KAAK,CAAE,OAFF,EAFA,CAAD,CAAR,CAQA6F,UAAU,CAAC,UAAM,CACfzF,QAAQ,CAAC,CACPH,IAAI,CAAEhB,YADC,CAEPiB,OAAO,gCACFmF,WADE,MAELrF,KAAK,CAAE,EAFF,EAFA,CAAD,CAAR,CAOD,CARS,CAQP,IARO,CAAV,CAUA,GAAIsF,UAAU,CAACM,KAAX,CAAiBjB,MAArB,CAA6BmB,MAAM,CAACC,QAAP,CAAgBC,MAAhB,GA/CI,qFAiDjC5F,QAAQ,CAAC,CACPH,IAAI,CAAEhB,YADC,CAEPiB,OAAO,gCACFmF,WADE,MAELrF,KAAK,CAAE,QAFF,EAFA,CAAD,CAAR,CAOAiG,OAAO,CAACC,GAAR,eAxDiC,uEAAN,wEAAxB,CA4DP,MAAO,IAAMC,CAAAA,qBAAqB,CAAG,QAAxBA,CAAAA,qBAAwB,CACnCC,eADmC,CAEnCC,WAFmC,CAGnCtG,eAHmC,CAIhC,CACH,MAAO,CACLE,IAAI,CAAEf,eADD,CAELgB,OAAO,CAAE,CACPkG,eAAe,CAAfA,eADO,CAEPC,WAAW,CAAXA,WAFO,CAGPtG,eAAe,CAAfA,eAHO,CAFJ,CAAP,CAQD,CAbM,CAeP,MAAO,IAAMuG,CAAAA,eAAe,CAAG,QAAlBA,CAAAA,eAAkB,oGAAM,mBAAOlG,QAAP,CAAiBC,QAAjB,gLACRA,QAAQ,EADA,CAC3BkG,cAD2B,aAC3BA,cAD2B,MAG/BA,cAAc,CAACF,WAAf,CAA2B1B,MAA3B,CAAoC,EAHL,4BAIjCvE,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,gCACFqG,cADE,MAELvG,KAAK,CAAE,2DAFF,EAFA,CAAD,CAAR,CAJiC,+CAYxBuG,cAAc,CAACF,WAAf,GAA+BE,cAAc,CAACxG,eAZtB,4BAajCK,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,gCACFqG,cADE,MAELvG,KAAK,CAAE,4DAFF,EAFA,CAAD,CAAR,CAbiC,0CAuBnCI,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,gCACFqG,cADE,MAELvG,KAAK,CAAE,QAFF,EAFA,CAAD,CAAR,CAQMkB,KA/B6B,CA+BrBwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CA/BqB,6CAkCdxD,CAAAA,KAAK,CAACiD,KAAN,CACjB,8BADiB,CAEjBmE,cAFiB,CAGjB,CACEvD,OAAO,CAAE,CACPC,aAAa,kBAAY/B,KAAZ,CADN,CADX,CAHiB,CAlCc,SAkC3BG,IAlC2B,iBA4CjC7B,SAAS,CAAC6B,IAAI,CAACC,IAAL,CAAUJ,KAAX,CAAT,CAEAd,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,CAAE,CACPkG,eAAe,CAAE,EADV,CAEPC,WAAW,CAAE,EAFN,CAGPtG,eAAe,CAAE,EAHV,CAIPC,KAAK,CAAE,OAJA,CAFF,CAAD,CAAR,CAUA6F,UAAU,CAAC,UAAM,CACfzF,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,CAAE,CACPkG,eAAe,CAAE,EADV,CAEPC,WAAW,CAAE,EAFN,CAGPtG,eAAe,CAAE,EAHV,CAIPC,KAAK,CAAE,EAJA,CAFF,CAAD,CAAR,CASD,CAVS,CAUP,IAVO,CAAV,CAxDiC,0FAoEjCI,QAAQ,CAAC,CACPH,IAAI,CAAEf,eADC,CAEPgB,OAAO,gCACFqG,cADE,MAELvG,KAAK,CAAE,QAFF,EAFA,CAAD,CAAR,CApEiC,0EAAN,yEAAxB,CA8EP,MAAO,IAAMwG,CAAAA,MAAM,CAAG,QAATA,CAAAA,MAAS,oGAAM,mBAAOpG,QAAP,CAAiBC,QAAjB,0HAC1BD,QAAQ,CAAC,CACPH,IAAI,CAAExB,SADC,CAEPyB,OAAO,CAAE,EAFF,CAAD,CAAR,CAKAE,QAAQ,CAAC,CACPH,IAAI,CAAEpB,aADC,CAEPqB,OAAO,CAAE,CAAEoB,IAAI,CAAE,EAAR,CAAYsD,aAAa,CAAE,CAA3B,CAFF,CAAD,CAAR,CAKAxE,QAAQ,CAAC,CACPH,IAAI,CAAEnB,KADC,CAEPoB,OAAO,CAAE,EAFF,CAAD,CAAR,CAKAwC,YAAY,CAAC+D,OAAb,CAAqB,OAArB,CAA8B,EAA9B,EAhB0B,wBAkBpBtH,CAAAA,KAAK,CAACiC,GAAN,CAAU,sBAAV,CAlBoB,2DAAN,yEAAf,CAqBP,MAAO,IAAMsF,CAAAA,aAAa,CAAG,QAAhBA,CAAAA,aAAgB,oGAAM,mBAAOtG,QAAP,CAAiBC,QAAjB,oIAC3Ba,KAD2B,CACnBwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CADmB,2CAIzBxD,CAAAA,KAAK,CAACwH,MAAN,CAAa,wBAAb,CAAuC,CAC3C3D,OAAO,CAAE,CACPC,aAAa,kBAAY/B,KAAZ,CADN,CADkC,CAAvC,CAJyB,QAS/B9B,OAAO,CAACwB,IAAR,CAAatB,IAAb,EAT+B,uFAW/B2G,OAAO,CAACC,GAAR,gBAX+B,wEAAN,yEAAtB,CAeP,MAAO,IAAMU,CAAAA,QAAQ,CAAG,QAAXA,CAAAA,QAAW,oGAAM,mBAAOxG,QAAP,oIACtBc,KADsB,CACdwB,YAAY,CAACC,OAAb,CAAqB,OAArB,CADc,CAE5BlD,cAAc,CAACW,QAAD,CAAWc,KAAX,CAAkB,IAAlB,CAAwB,IAAxB,CAA8B,KAA9B,CAAqC,IAArC,CAAd,CAF4B,0DAAN,oEAAjB","sourcesContent":["import {\r\n  NEW_USER_DATA,\r\n  newUserDataState,\r\n  AUTH_USER,\r\n  LOGIN_USER_DATA,\r\n  FORGOT_PASSWORD,\r\n  RESET_PASSWORD_DATA,\r\n  CONVERSATIONS,\r\n  USERS,\r\n  ACTIVE_CONVERSATION,\r\n  MESSAGE_DATA,\r\n  PROFILE_DATA,\r\n  CHANGE_PASSWORD,\r\n} from \"./types\";\r\nimport axios from \"../utils/axios\";\r\nimport history from \"../utils/history\";\r\nimport { emailConfirmation, root } from \"../utils/Routes\";\r\nimport EMOJIS from \"../utils/emojis\";\r\nimport { saveToken, loadDataHelper } from \"./helper\";\r\n\r\nexport const setNewUserData = (\r\n  newUser,\r\n  username,\r\n  email,\r\n  password,\r\n  confirmPassword,\r\n  state\r\n) => {\r\n  if (newUser) {\r\n    return {\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        username,\r\n        email,\r\n        password,\r\n        confirmPassword,\r\n        state,\r\n      },\r\n    };\r\n  } else {\r\n    return {\r\n      type: NEW_USER_DATA,\r\n      payload: null,\r\n    };\r\n  }\r\n};\r\n\r\nexport const signupUser = () => async (dispatch, getState) => {\r\n  const { newUserData } = getState();\r\n  newUserData.joinedAt = Date.now();\r\n\r\n  try {\r\n    await axios.post(\"/api/v1/users/signup\", newUserData);\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        ...newUserData,\r\n        state: newUserDataState.submitted,\r\n      },\r\n    });\r\n    history.push(emailConfirmation);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        ...newUserData,\r\n        state: newUserDataState.failed,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const resendAccountActivateEmail = () => async (dispatch, getState) => {\r\n  const { newUserData } = getState();\r\n\r\n  dispatch({\r\n    type: NEW_USER_DATA,\r\n    payload: {\r\n      ...newUserData,\r\n      state: newUserDataState.resubmitting,\r\n    },\r\n  });\r\n\r\n  try {\r\n    await axios.post(\"/api/v1/users/resendActivationLink\", {\r\n      email: newUserData.email,\r\n    });\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        ...newUserData,\r\n        state: newUserDataState.submitted,\r\n      },\r\n    });\r\n    history.push(emailConfirmation);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        ...newUserData,\r\n        state: newUserDataState.emailNotExist,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const activateAccount = (token) => async (dispatch) => {\r\n  dispatch({\r\n    type: NEW_USER_DATA,\r\n    payload: {\r\n      username: \"\",\r\n      email: \"\",\r\n      password: \"\",\r\n      confirmPassword: \"\",\r\n      state: newUserDataState.activatingAccount,\r\n    },\r\n  });\r\n  try {\r\n    const user = await axios.get(`/api/v1/users/activateAccount/${token}`);\r\n\r\n    dispatch({\r\n      type: AUTH_USER,\r\n      payload: {\r\n        token: user.data.token,\r\n        user: user.data.user,\r\n      },\r\n    });\r\n\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        username: \"\",\r\n        email: \"\",\r\n        password: \"\",\r\n        confirmPassword: \"\",\r\n        state: newUserDataState.accountActivated,\r\n      },\r\n    });\r\n\r\n    saveToken(user.data.token);\r\n\r\n    history.push(\"/conversations\");\r\n\r\n    loadDataHelper(dispatch, user.data.token, true, true, user.data.user);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: NEW_USER_DATA,\r\n      payload: {\r\n        username: \"\",\r\n        email: \"\",\r\n        password: \"\",\r\n        confirmPassword: \"\",\r\n        state: newUserDataState.invalidToken,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const setLoginData = (mount, email, password) => {\r\n  if (mount) {\r\n    return {\r\n      type: LOGIN_USER_DATA,\r\n      payload: {\r\n        email,\r\n        password,\r\n      },\r\n    };\r\n  } else {\r\n    return {\r\n      type: LOGIN_USER_DATA,\r\n      payload: null,\r\n    };\r\n  }\r\n};\r\n\r\nexport const loginUser = () => async (dispatch, getState) => {\r\n  const { loginUserData } = getState();\r\n\r\n  dispatch({\r\n    type: LOGIN_USER_DATA,\r\n    payload: {\r\n      ...loginUserData,\r\n      state: \"submitting\",\r\n    },\r\n  });\r\n\r\n  try {\r\n    const user = await axios.post(\"/api/v1/users/login\", loginUserData);\r\n\r\n    dispatch({\r\n      type: AUTH_USER,\r\n      payload: {\r\n        user: user.data.user,\r\n      },\r\n    });\r\n\r\n    saveToken(user.data.token);\r\n\r\n    history.push(\"/conversations\");\r\n\r\n    loadDataHelper(dispatch, user.data.token, true, true, user.data.user);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: LOGIN_USER_DATA,\r\n      payload: {\r\n        ...loginUserData,\r\n        loginFailed: true,\r\n        state: \"failed\",\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const setForgotPassword = (email, state, mount) => {\r\n  if (mount) {\r\n    return {\r\n      type: FORGOT_PASSWORD,\r\n      payload: {\r\n        email,\r\n        state,\r\n      },\r\n    };\r\n  } else {\r\n    return {\r\n      type: FORGOT_PASSWORD,\r\n      payload: null,\r\n    };\r\n  }\r\n};\r\n\r\nexport const sendForgotPassword = () => async (dispatch, getState) => {\r\n  const { email } = getState().forgotPassword;\r\n\r\n  dispatch({\r\n    type: FORGOT_PASSWORD,\r\n    payload: {\r\n      email,\r\n      state: \"submitting\",\r\n    },\r\n  });\r\n\r\n  try {\r\n    await axios.post(\"/api/v1/users/forgotPassword\", { email });\r\n    dispatch({\r\n      type: FORGOT_PASSWORD,\r\n      payload: {\r\n        email,\r\n        state: \"submitted\",\r\n      },\r\n    });\r\n  } catch (err) {\r\n    dispatch({\r\n      type: FORGOT_PASSWORD,\r\n      payload: {\r\n        email,\r\n        state: \"failed\",\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const setResetPassword = (mount, password, confirmPassword, state) => {\r\n  if (mount) {\r\n    return {\r\n      type: RESET_PASSWORD_DATA,\r\n      payload: {\r\n        password,\r\n        confirmPassword,\r\n        state,\r\n      },\r\n    };\r\n  } else {\r\n    return {\r\n      type: RESET_PASSWORD_DATA,\r\n      payload: null,\r\n    };\r\n  }\r\n};\r\n\r\nexport const resetPassword = (token) => async (dispatch, getState) => {\r\n  const { resetPasswordData } = getState();\r\n\r\n  dispatch({\r\n    type: RESET_PASSWORD_DATA,\r\n    payload: {\r\n      ...resetPasswordData,\r\n      state: \"submitting\",\r\n    },\r\n  });\r\n\r\n  try {\r\n    const user = await axios.patch(\r\n      `/api/v1/users/resetPassword/${token}`,\r\n      resetPasswordData\r\n    );\r\n\r\n    dispatch({\r\n      type: AUTH_USER,\r\n      payload: {\r\n        token: user.data.token,\r\n        user: user.data.user,\r\n      },\r\n    });\r\n\r\n    saveToken(user.data.token);\r\n\r\n    history.push(\"/conversations\");\r\n\r\n    loadDataHelper(dispatch, user.data.token, true, true, user.data.user);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: RESET_PASSWORD_DATA,\r\n      payload: {\r\n        ...resetPasswordData,\r\n        state: newUserDataState.invalidToken,\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const setActiveConversation = (conversation) => {\r\n  return {\r\n    type: ACTIVE_CONVERSATION,\r\n    payload: conversation,\r\n  };\r\n};\r\n\r\nexport const createConversation = (id) => async (dispatch, getState) => {\r\n  const { auth } = getState();\r\n\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  dispatch({\r\n    type: ACTIVE_CONVERSATION,\r\n    payload: {\r\n      state: \"creating\",\r\n      id,\r\n    },\r\n  });\r\n\r\n  try {\r\n    await axios.post(\r\n      \"/api/v1/conversations\",\r\n      { user1: auth.user._id, user2: id, createdAt: Date.now() },\r\n      {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n  } catch (err) {\r\n    dispatch({\r\n      type: ACTIVE_CONVERSATION,\r\n      payload: {\r\n        state: \"failed\",\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const setMessageData = (message, state) => {\r\n  return {\r\n    type: MESSAGE_DATA,\r\n    payload: {\r\n      message,\r\n      state,\r\n    },\r\n  };\r\n};\r\n\r\nexport const sendMessage = () => async (dispatch, getState) => {\r\n  const { message, auth, activeConversation } = getState();\r\n\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  dispatch({\r\n    type: MESSAGE_DATA,\r\n    payload: {\r\n      message: message.message,\r\n      state: \"submitting\",\r\n    },\r\n  });\r\n\r\n  try {\r\n    await axios.post(\r\n      \"/api/v1/messages\",\r\n      {\r\n        conversation: activeConversation._id,\r\n        user: auth.user._id,\r\n        message: message.message,\r\n        createdAt: Date.now(),\r\n      },\r\n      {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    dispatch({\r\n      type: MESSAGE_DATA,\r\n      payload: {\r\n        message: \"\",\r\n        state: \"submitted\",\r\n      },\r\n    });\r\n  } catch (err) {\r\n    dispatch({\r\n      type: MESSAGE_DATA,\r\n      payload: {\r\n        message: message.message,\r\n        state: \"failed\",\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const userInserted = (user) => (dispatch, getState) => {\r\n  const { users } = getState();\r\n  if (users.findIndex((sUser) => sUser._id === user._id) === -1) {\r\n    const newUsers = [...users, user];\r\n\r\n    dispatch({\r\n      type: USERS,\r\n      payload: [...newUsers],\r\n    });\r\n  }\r\n};\r\n\r\nexport const userUpdated = (updates) => (dispatch, getState) => {\r\n  let { users, auth } = getState();\r\n\r\n  let updatedUser;\r\n  let i = users.findIndex((user) => user._id === updates.id);\r\n\r\n  if (i < 0) return;\r\n\r\n  updatedUser = {\r\n    ...users[i],\r\n    ...updates.updatedFields,\r\n  };\r\n\r\n  if (auth.user._id === updates.id) {\r\n    dispatch({\r\n      type: AUTH_USER,\r\n      payload: {\r\n        ...auth,\r\n        user: updatedUser,\r\n      },\r\n    });\r\n  }\r\n\r\n  users = [...users.slice(0, i), updatedUser, ...users.slice(i + 1)];\r\n\r\n  dispatch({\r\n    type: USERS,\r\n    payload: users,\r\n  });\r\n};\r\n\r\nexport const userDeleted = (id) => (dispatch, getState) => {\r\n  const { users } = getState();\r\n\r\n  const newUsers = users.filter((user) => user._id !== id);\r\n\r\n  dispatch({\r\n    type: USERS,\r\n    payload: [...newUsers],\r\n  });\r\n};\r\n\r\nexport const conversationInserted = (doc) => (dispatch, getState) => {\r\n  let { conversations, auth, activeConversation } = getState();\r\n\r\n  // insert conversation only if it is for auth user\r\n  if (doc.user1 === auth.user._id || doc.user2 === auth.user._id) {\r\n    if (conversations.data.findIndex((con) => con._id === doc._id) === -1) {\r\n      conversations.data = [...conversations.data, doc];\r\n\r\n      let count = 0;\r\n      conversations.data.forEach((con) => {\r\n        const lastMsg = con.messages[con.messages.length - 1];\r\n\r\n        if (!lastMsg || lastMsg.user !== auth.user._id) {\r\n          count++;\r\n        }\r\n      });\r\n\r\n      dispatch({\r\n        type: CONVERSATIONS,\r\n        payload: {\r\n          data: [...conversations.data],\r\n          notifications: count,\r\n        },\r\n      });\r\n\r\n      if (activeConversation && activeConversation.id) {\r\n        dispatch({\r\n          type: ACTIVE_CONVERSATION,\r\n          payload: doc,\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const conversationDeleted = (data) => (dispatch, getState) => {\r\n  let { conversations, auth, activeConversation } = getState();\r\n\r\n  if (activeConversation && activeConversation._id === data._id) {\r\n    dispatch({\r\n      type: ACTIVE_CONVERSATION,\r\n      payload: null,\r\n    });\r\n  }\r\n\r\n  conversations.data = conversations.data.filter((con) => con._id !== data._id);\r\n\r\n  let count = 0;\r\n  conversations.data.forEach((con) => {\r\n    const lastMsg = con.messages[con.messages.length - 1];\r\n\r\n    if (!lastMsg || lastMsg.user !== auth.user._id) {\r\n      count++;\r\n    }\r\n  });\r\n\r\n  dispatch({\r\n    type: CONVERSATIONS,\r\n    payload: {\r\n      data: [...conversations.data],\r\n      notifications: count,\r\n    },\r\n  });\r\n};\r\n\r\nexport const messageInserted = (doc) => (dispatch, getState) => {\r\n  const { conversations, auth } = getState();\r\n\r\n  let i = conversations.data.findIndex((con) => con._id === doc.conversation);\r\n\r\n  if (i >= 0) {\r\n    if (\r\n      conversations.data[i].messages.findIndex((el) => el._id === doc._id) ===\r\n      -1\r\n    ) {\r\n      conversations.data[i].messages = [...conversations.data[i].messages, doc];\r\n\r\n      const newConversations = [...conversations.data];\r\n\r\n      let count = 0;\r\n      newConversations.forEach((con) => {\r\n        const lastMsg = con.messages[con.messages.length - 1];\r\n\r\n        if (!lastMsg || lastMsg.user !== auth.user._id) {\r\n          count++;\r\n        }\r\n      });\r\n\r\n      dispatch({\r\n        type: CONVERSATIONS,\r\n        payload: {\r\n          data: newConversations,\r\n          notifications: count,\r\n        },\r\n      });\r\n\r\n      if (doc.user === auth.user._id) {\r\n        dispatch({\r\n          type: ACTIVE_CONVERSATION,\r\n          payload: newConversations[i],\r\n        });\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\nexport const addEmoji = (id) => (dispatch, getState) => {\r\n  const { message } = getState();\r\n\r\n  let emoji = EMOJIS.slice(id, id + 2);\r\n\r\n  dispatch({\r\n    type: MESSAGE_DATA,\r\n    payload: {\r\n      ...message,\r\n      message: message.message + emoji,\r\n    },\r\n  });\r\n};\r\n\r\nexport const setProfileData = (username, email) => {\r\n  return {\r\n    type: PROFILE_DATA,\r\n    payload: {\r\n      username,\r\n      email,\r\n    },\r\n  };\r\n};\r\n\r\nexport const saveProfileData = () => async (dispatch, getState) => {\r\n  const { profileData } = getState();\r\n\r\n  const userAvatar = document.querySelector(\".user-avatar\");\r\n  const formData = new FormData();\r\n  formData.append(\"username\", profileData.username);\r\n  formData.append(\"email\", profileData.email);\r\n\r\n  if (userAvatar.files.length) {\r\n    formData.append(\"avatar\", userAvatar.files[0]);\r\n  }\r\n\r\n  dispatch({\r\n    type: PROFILE_DATA,\r\n    payload: {\r\n      ...profileData,\r\n      state: \"saving\",\r\n    },\r\n  });\r\n\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  try {\r\n    await axios.patch(\"/api/v1/users/updateMe\", formData, {\r\n      headers: {\r\n        authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n\r\n    dispatch({\r\n      type: PROFILE_DATA,\r\n      payload: {\r\n        ...profileData,\r\n        state: \"saved\",\r\n      },\r\n    });\r\n\r\n    setTimeout(() => {\r\n      dispatch({\r\n        type: PROFILE_DATA,\r\n        payload: {\r\n          ...profileData,\r\n          state: \"\",\r\n        },\r\n      });\r\n    }, 3000);\r\n\r\n    if (userAvatar.files.length) window.location.reload();\r\n  } catch (err) {\r\n    dispatch({\r\n      type: PROFILE_DATA,\r\n      payload: {\r\n        ...profileData,\r\n        state: \"failed\",\r\n      },\r\n    });\r\n    console.log(err);\r\n  }\r\n};\r\n\r\nexport const setChangePasswordData = (\r\n  currentPassword,\r\n  newPassword,\r\n  confirmPassword\r\n) => {\r\n  return {\r\n    type: CHANGE_PASSWORD,\r\n    payload: {\r\n      currentPassword,\r\n      newPassword,\r\n      confirmPassword,\r\n    },\r\n  };\r\n};\r\n\r\nexport const saveNewPassword = () => async (dispatch, getState) => {\r\n  const { changePassword } = getState();\r\n\r\n  if (changePassword.newPassword.length < 12) {\r\n    dispatch({\r\n      type: CHANGE_PASSWORD,\r\n      payload: {\r\n        ...changePassword,\r\n        state: \"validation,New password length should be greater than 12.\",\r\n      },\r\n    });\r\n    return;\r\n  } else if (changePassword.newPassword !== changePassword.confirmPassword) {\r\n    dispatch({\r\n      type: CHANGE_PASSWORD,\r\n      payload: {\r\n        ...changePassword,\r\n        state: \"validation,New password and Confirm password are not same.\",\r\n      },\r\n    });\r\n    return;\r\n  }\r\n\r\n  dispatch({\r\n    type: CHANGE_PASSWORD,\r\n    payload: {\r\n      ...changePassword,\r\n      state: \"saving\",\r\n    },\r\n  });\r\n\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  try {\r\n    const user = await axios.patch(\r\n      \"/api/v1/users/updatePassword\",\r\n      changePassword,\r\n      {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      }\r\n    );\r\n\r\n    saveToken(user.data.token);\r\n\r\n    dispatch({\r\n      type: CHANGE_PASSWORD,\r\n      payload: {\r\n        currentPassword: \"\",\r\n        newPassword: \"\",\r\n        confirmPassword: \"\",\r\n        state: \"saved\",\r\n      },\r\n    });\r\n\r\n    setTimeout(() => {\r\n      dispatch({\r\n        type: CHANGE_PASSWORD,\r\n        payload: {\r\n          currentPassword: \"\",\r\n          newPassword: \"\",\r\n          confirmPassword: \"\",\r\n          state: \"\",\r\n        },\r\n      });\r\n    }, 3000);\r\n  } catch (err) {\r\n    dispatch({\r\n      type: CHANGE_PASSWORD,\r\n      payload: {\r\n        ...changePassword,\r\n        state: \"failed\",\r\n      },\r\n    });\r\n  }\r\n};\r\n\r\nexport const logout = () => async (dispatch, getState) => {\r\n  dispatch({\r\n    type: AUTH_USER,\r\n    payload: {},\r\n  });\r\n\r\n  dispatch({\r\n    type: CONVERSATIONS,\r\n    payload: { data: [], notifications: 0 },\r\n  });\r\n\r\n  dispatch({\r\n    type: USERS,\r\n    payload: [],\r\n  });\r\n\r\n  localStorage.setItem(\"token\", \"\");\r\n\r\n  await axios.get(\"/api/v1/users/logout\");\r\n};\r\n\r\nexport const deleteAccount = () => async (dispatch, getState) => {\r\n  const token = localStorage.getItem(\"token\");\r\n\r\n  try {\r\n    await axios.delete(\"/api/v1/users/deleteMe\", {\r\n      headers: {\r\n        authorization: `Bearer ${token}`,\r\n      },\r\n    });\r\n    history.push(root);\r\n  } catch (err) {\r\n    console.log(err);\r\n  }\r\n};\r\n\r\nexport const loadData = () => async (dispatch) => {\r\n  const token = localStorage.getItem(\"token\");\r\n  loadDataHelper(dispatch, token, true, true, false, true);\r\n};\r\n"]},"metadata":{},"sourceType":"module"}