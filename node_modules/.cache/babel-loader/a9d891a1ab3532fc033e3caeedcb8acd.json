{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _toConsumableArray from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _asyncToGenerator from\"C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import axios from\"../utils/axios\";import{AUTH_USER,USERS,CONVERSATIONS,APP_DATA_LOADING,PROFILE_DATA}from\"./types\";import history from\"../utils/history\";import{login,changePassword,conversations,updateProfile}from\"../utils/Routes\";export var saveToken=function saveToken(token){localStorage.setItem(\"token\",token);localStorage.setItem(\"exp\",Date.now()+30*24*60*60*1000);};export var loadDataHelper=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(dispatch,token,cons,users,user,me){var _me,_users,_conversations,count,path;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:dispatch({type:APP_DATA_LOADING,payload:\"loading\"});_context.prev=1;if(!me){_context.next=8;break;}_context.next=5;return axios.get(\"/api/v1/users/me\",{headers:{authorization:\"Bearer \".concat(token)}});case 5:_me=_context.sent;dispatch({type:AUTH_USER,payload:{user:_me.data.user}});user=_me.data.user;case 8:dispatch({type:PROFILE_DATA,payload:{username:user.username,email:user.email}});if(!users){_context.next=14;break;}_context.next=12;return axios.get(\"/api/v1/users\",{headers:{authorization:\"Bearer \".concat(token)}});case 12:_users=_context.sent;dispatch({type:USERS,payload:_toConsumableArray(_users.data.users)});case 14:if(!cons){_context.next=21;break;}_context.next=17;return axios.get(\"/api/v1/conversations\",{headers:{authorization:\"Bearer \".concat(token)}});case 17:_conversations=_context.sent;count=0;_conversations.data.conversations.forEach(function(con){var lastMsg=con.messages[con.messages.length-1];if(!lastMsg||lastMsg.user!==user._id){count++;}});dispatch({type:CONVERSATIONS,payload:{data:_conversations.data.conversations,notifications:count}});case 21:dispatch({type:APP_DATA_LOADING,payload:\"loaded\"});_context.next=35;break;case 24:_context.prev=24;_context.t0=_context[\"catch\"](1);dispatch({type:APP_DATA_LOADING,payload:\"failed\"});console.log(_context.t0);path=window.location.href.split(\"#\")[1];_context.t1=path;_context.next=_context.t1===conversations?32:_context.t1===updateProfile?32:_context.t1===changePassword?32:34;break;case 32:history.push(login);return _context.abrupt(\"break\",35);case 34:return _context.abrupt(\"return\");case 35:case\"end\":return _context.stop();}}},_callee,null,[[1,24]]);}));return function loadDataHelper(_x,_x2,_x3,_x4,_x5,_x6){return _ref.apply(this,arguments);};}();","map":{"version":3,"sources":["C:/Users/Ghassen/Desktop/lyoum/3/chat-app-client/src/actions/helper.js"],"names":["axios","AUTH_USER","USERS","CONVERSATIONS","APP_DATA_LOADING","PROFILE_DATA","history","login","changePassword","conversations","updateProfile","saveToken","token","localStorage","setItem","Date","now","loadDataHelper","dispatch","cons","users","user","me","type","payload","get","headers","authorization","data","username","email","count","forEach","con","lastMsg","messages","length","_id","notifications","console","log","path","window","location","href","split","push"],"mappings":"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","sourcesContent":["import axios from \"../utils/axios\";\r\nimport {\r\n  AUTH_USER,\r\n  USERS,\r\n  CONVERSATIONS,\r\n  APP_DATA_LOADING,\r\n  PROFILE_DATA,\r\n} from \"./types\";\r\nimport history from \"../utils/history\";\r\nimport {\r\n  login,\r\n  changePassword,\r\n  conversations,\r\n  updateProfile,\r\n} from \"../utils/Routes\";\r\n\r\nexport const saveToken = (token) => {\r\n  localStorage.setItem(\"token\", token);\r\n  localStorage.setItem(\"exp\", Date.now() + 30 * 24 * 60 * 60 * 1000);\r\n};\r\n\r\nexport const loadDataHelper = async (\r\n  dispatch,\r\n  token,\r\n  cons,\r\n  users,\r\n  user,\r\n  me\r\n) => {\r\n  dispatch({\r\n    type: APP_DATA_LOADING,\r\n    payload: \"loading\",\r\n  });\r\n\r\n  try {\r\n    if (me) {\r\n      const me = await axios.get(\"/api/v1/users/me\", {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      dispatch({\r\n        type: AUTH_USER,\r\n        payload: {\r\n          user: me.data.user,\r\n        },\r\n      });\r\n\r\n      user = me.data.user;\r\n    }\r\n\r\n    dispatch({\r\n      type: PROFILE_DATA,\r\n      payload: {\r\n        username: user.username,\r\n        email: user.email,\r\n      },\r\n    });\r\n\r\n    if (users) {\r\n      const users = await axios.get(\"/api/v1/users\", {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      dispatch({\r\n        type: USERS,\r\n        payload: [...users.data.users],\r\n      });\r\n    }\r\n\r\n    if (cons) {\r\n      const conversations = await axios.get(\"/api/v1/conversations\", {\r\n        headers: {\r\n          authorization: `Bearer ${token}`,\r\n        },\r\n      });\r\n\r\n      let count = 0;\r\n      conversations.data.conversations.forEach((con) => {\r\n        const lastMsg = con.messages[con.messages.length - 1];\r\n\r\n        if (!lastMsg || lastMsg.user !== user._id) {\r\n          count++;\r\n        }\r\n      });\r\n\r\n      dispatch({\r\n        type: CONVERSATIONS,\r\n        payload: {\r\n          data: conversations.data.conversations,\r\n          notifications: count,\r\n        },\r\n      });\r\n    }\r\n\r\n    dispatch({\r\n      type: APP_DATA_LOADING,\r\n      payload: \"loaded\",\r\n    });\r\n  } catch (err) {\r\n    dispatch({\r\n      type: APP_DATA_LOADING,\r\n      payload: \"failed\",\r\n    });\r\n    console.log(err);\r\n\r\n    const path = window.location.href.split(\"#\")[1];\r\n    switch (path) {\r\n      case conversations:\r\n      case updateProfile:\r\n      case changePassword:\r\n        history.push(login);\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n  }\r\n};\r\n"]},"metadata":{},"sourceType":"module"}